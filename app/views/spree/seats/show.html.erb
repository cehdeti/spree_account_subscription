<h2>Subscription Seat</h2>


<div class="row">
  <div class="col-xs-12">
    <div class="well">




      <p>Below are the details of this subscription seat.</p>


      <% if @seat.user == @seat.account_subscription.user %>
      <p>In order to renew this seat or extend the license period, you can manage your subscription purchase here: </p>
      <p><a class="button button-primary" href="/subscriptions/<%= @seat.account_subscription.id %>">Manage subscription</a></p>

      <% else %>


      <p>In order to renew this seat or extend the license period, you have two options: </p>
      <ul>
        <li>You may contact <a href="mailto:<%= @seat.account_subscription.user.email%>">the purchaser of your subscription</a> to have them renew the subscription.</li>
        <li>You may also 'spin off' this seat into your own subscription, and renew it below. This will add one year on to your existing subscription.</li>
      </ul>

      <% end %>

    </div>
  </div>
</div>

<div class="row">

  <div class="col-xs-12 col-md-2">
    <h5>Product</h5>
    <a href="/products/<%= @seat.account_subscription.product.slug%>"><%= @seat.account_subscription.product.name %></a>
  </div>
  <div class="col-xs-12 col-md-2">
    <h5>User</h5>
    <a href="mailto:<%=@seat.user.email%>"><%= @seat.user.email %></a>
  </div>
  <div class="col-xs-12 col-md-2">
    <h5>Purchaser</h5>
    <a href="mailto:<%=@seat.account_subscription.user.email%>"><%= @seat.account_subscription.user.email %></a>
  </div>
  <div class="col-xs-12 col-md-2">
    <h5>Token</h5>
    <span style="word-break: break-all;font-family: monospace;"><%= @seat.account_subscription.token%></span>

  </div>
  <div class="col-xs-12 col-md-2">
    <h5>Status</h5>
    <%= @seat.account_subscription.state %>
  </div>
  <div class="col-xs-12 col-md-2">
    <h5>Expires</h5>
    <%= @seat.account_subscription.end_datetime.strftime(" %m/%d/%Y")%>
  </div>
</div>



<% if @seat.user != @seat.account_subscription.user %>
<div class="row" style="margin-top:20px;">
  <div class="col-sm-12">
    <div class="well">

      <%= form_for :order, url: populate_orders_path do |f| %>
          <div class="row" id="inside-product-cart-form" data-hook="inside_product_cart_form" itemprop="offers" itemscope itemtype="https://schema.org/Offer">
            <div id="product-variants" class="col-md-6">

              <div style="visibility: hidden;display:none;">

                <% @product.variants_and_option_values(current_currency).each_with_index do |variant, index| %>
                    <% if variant.options_text.include? "Renewal" %>
                        <%= radio_button_tag "variant_id", variant.id, index == 0,
                                             'data-price' => variant.price_in(current_currency).money,
                                             'data-in-stock' => variant.can_supply?,
                                             'checked'=>'checked'
                        %>
                        <%= label_tag "variant_id_#{ variant.id }" do %>
                    <span class="variant-description">
                      <%= variant_options variant %>
                    </span>
                    <span class="price diff">
                      <%= variant_full_price variant %>
                    </span>
                        <% end %>
                    <% end %>
                <% end%>

              </div>


              <% if @product.price_in(current_currency) && !@product.price.nil? %>
                  <div data-hook="product_price" class="col-md-5">
                    <div id="product-price">
                      <h5 class="product-section-title">Renewal Price</h5>
                      <div>
                      <span class="lead price selling" itemprop="price">
                        <%= display_price(@product) %>
                      </span>
                        <span itemprop="priceCurrency" content="<%= @product.currency %>"></span>
                      </div>
                    </div>

                    <% if @product.can_supply? %>
                        <%= hidden_field_tag :quantity, 1 %>
                        <%= hidden_field_tag "options[renewing_subscription_id]", @seat.account_subscription.id %>
                        <%= hidden_field_tag "options[renewing_seat_id]", @seat.id %>
                        <%= hidden_field_tag "options[is_spinoff]", true %>

                        <%= button_tag class: 'btn button-accent', id: 'add-to-cart-button', type: :submit do %>
                            <%= Spree.t(:add_to_cart) %>
                        <% end %>
                        </div>
                    <% end %>
                    </div>
              <% else %>
                  <div id="product-price">
                    <br />
                    <div>
          <span class="price selling" itemprop="price">
            <%= Spree.t('product_not_available_in_this_currency') %>
          </span>
                    </div>
                  </div>
              <% end %>

              </div>
          </div>
      <% end %>


    </div>
  </div>
</div>


<% end %>